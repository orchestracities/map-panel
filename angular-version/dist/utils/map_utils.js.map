{"version":3,"sources":["../../src/utils/map_utils.js"],"names":["getDataPointStickyInfo","dataPoint","metricsTranslations","stickyInfo","bodyData","getDataPointDetails","name","Object","keys","length","id","bodyClass","translate","join","footData","footClass","skipkey","include","filter","key","includes","reduce","obj","objToString","str","p","hasOwnProperty","filteredData","cssClass","translatedValues","map","dpKey","dP","Date","toLocaleString","isNaN","Number","isInteger","parseFloat","toFixed","trans","elem","translatedValue","value","unit","getSelectedCity","vars","selectedVarName","cityEnv","city","current","getCityCoordinates","city_name","url","NOMINATIM_ADDRESS","replace","fetch","then","response","json","data","latitude","lat","longitude","lon","error","console","convertDate","time_","time","day","getDate","month","getMonth","year","getFullYear","hour","getHours","minutes","getMinutes","seconds","getSeconds","milliseconds","getMilliseconds","UTC","geolocationOptions","enableHighAccuracy","timeout","maximumAge"],"mappings":"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","sourcesContent":["// draw components in the map\n/* Vendor specific */\nimport { defaults, isEqual } from 'lodash';\n\nimport config from 'app/core/config';\n\n/* Grafana Specific */\n\nimport { titleize } from './string';\n\n\n/**\n* private functions\n*/\n\nfunction getDataPointStickyInfo(dataPoint, metricsTranslations) {\n  let stickyInfo = '<div class=\"stycky-popup-info\">';\n\n  var bodyData = getDataPointDetails(dataPoint, ['geojson', 'id', 'type', 'created_at', 'longitude', 'latitude' , 'name'], false);\n\n  if (dataPoint.name && Object.keys(bodyData).length > 1){\n    stickyInfo += '<div class=\"head\">' + dataPoint.name + '</div>';\n  } else if (dataPoint.id && Object.keys(bodyData).length > 1) {\n    stickyInfo += '<div class=\"head\">' + dataPoint.id + '</div>';\n  } else if (Object.keys(bodyData).length === 1){\n    stickyInfo += '<div class=\"head\">' + Object.keys(bodyData)[0] + '</div>';\n  }\n\n  var bodyClass = 'popup-single-value';\n  if (Object.keys(bodyData).length > 1){\n    bodyClass = 'popup-multiple-value';\n  }\n\n  // body\n  stickyInfo += '<div class=\"body\">';\n  stickyInfo += translate(bodyData, metricsTranslations, bodyClass).join('');\n  stickyInfo += '</div>';\n\n  // foot\n  var footData;\n  if (Object.keys(bodyData).length === 1 && dataPoint.name){\n    footData = getDataPointDetails(dataPoint, ['created_at', 'name'], true);\n  } else {\n    footData = getDataPointDetails(dataPoint, ['created_at'], true);\n  }\n\n\n  var footClass = '';\n\n  stickyInfo += '<div class=\"foot\">';\n  stickyInfo+= translate(footData, metricsTranslations, footClass).join('');\n  stickyInfo += '</div>';\n  return stickyInfo;\n}\n\nfunction getDataPointDetails(dataPoint, skipkey, include) {\n  return include? Object.keys(dataPoint).filter(key => skipkey.includes(key)).reduce((obj, key) => { obj[key] = dataPoint[key]; return obj; }, {}) : Object.keys(dataPoint).filter(key => !skipkey.includes(key)).reduce((obj, key) => { obj[key] = dataPoint[key]; return obj; }, {});\n}\n\n\nfunction objToString (obj) {\n    var str = '<div>';\n    for (var p in obj) {\n        if (obj.hasOwnProperty(p)) {\n            if(typeof obj[p] === 'object'){\n              str += p + ': ' + objToString(obj[p]) + '<br/>';\n            } else {\n              str += p + ': ' + obj[p] + '<br/>';\n            }\n        }\n    }\n    str += '</div>';\n    return str;\n}\n\nfunction translate(filteredData, metricsTranslations, cssClass){\n  const keys = Object.keys(filteredData);\n  const translatedValues =   keys.map((dpKey) => {\n    const dP = (dpKey === 'created_at' ? new Date(filteredData[dpKey]).toLocaleString() : typeof filteredData[dpKey] === 'object' ? objToString(filteredData[dpKey]) : typeof filteredData[dpKey] === 'boolean' ? filteredData[dpKey] : isNaN(filteredData[dpKey]) ? filteredData[dpKey] : Number.isInteger(filteredData[dpKey]) ? filteredData[dpKey] : parseFloat(filteredData[dpKey].toFixed(2)) );\n    const trans = metricsTranslations.filter((elem) => elem[0] === dpKey);\n    return { 'name': (trans.length > 0 && trans[0][1] ? trans[0][1] : titleize(dpKey)), 'value': dP || '-', 'unit': (trans.length > 0 ? trans[0][2] : '') };\n  });\n  return translatedValues.map((translatedValue) => `<div class='${cssClass}'><span class='name'>${translatedValue.name}</span><span class='value'>${translatedValue.value}</span><span class ='unit'>${translatedValue.unit || ''}</span></div>`);\n}\n\n// Given vars passed as param, retrieves the selected city\nfunction getSelectedCity(vars, selectedVarName) {\n  const cityEnv = vars.filter((elem) => elem.name === selectedVarName);\n\n  let city = null;\n  if (cityEnv && cityEnv.length === 1) city = cityEnv[0].current.value;\n\n  return city;\n}\n\n// Access remote api and gives the coordinates from a city center based on NOMINATIM url server\nfunction getCityCoordinates(city_name) {\n  const url = NOMINATIM_ADDRESS.replace('<city_name>', city_name);\n  return fetch(url)\n    .then((response) => response.json())\n    .then((data) => { return { latitude: data[0].lat, longitude: data[0].lon }; })\n    .catch((error) => console.error(error));\n}\n/*\n* Auxiliar functions\n*/\n// just for improve DRY\nfunction convertDate(time_) {\n  const time = new Date(time_);\n  const day = time.getDate();\n  const month = time.getMonth();\n  const year = time.getFullYear();\n  const hour = time.getHours() - 1;\n  const minutes = time.getMinutes();\n  const seconds = time.getSeconds();\n  const milliseconds = time.getMilliseconds();\n  return Date.UTC(year, month, day, hour + 1, minutes, seconds, milliseconds);\n}\n\nconst geolocationOptions = {\n  enableHighAccuracy: true,\n  timeout: 5000,\n  maximumAge: 110\n};\n\nexport {\n\n  getCityCoordinates,\n\n  getDataPointStickyInfo,\n\n  getSelectedCity,\n\n  geolocationOptions\n};\n"],"file":"map_utils.js"}